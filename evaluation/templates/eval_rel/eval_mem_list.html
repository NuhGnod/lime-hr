
<div class="box-header">
    <h3 class="box-title">사원 목록</h3>
</div>
<div class="box-body">

<div class="row">
    <div class="col-md-10">
        <table id="memList" class="table table-bordered table-striped hover">
            <thead>
                <tr>
                    <th style="width: 1px"></th>
                    <th>사원명</th>
                    <th>그룹</th>
                    <th>부서</th>
                    <th>직책</th>
                    <th>직위</th>
                </tr>
            </thead>
            <tbody>
                {% for mem in euso_mem_list %}
                    <tr id="row_{{ mem.id }}" style="cursor: pointer;" onclick="chkBoxClick('row_{{ mem.id }}')">
                        <td>
                            <input name="memIdChkBox" type="checkbox" value='{"mem_id": "{{ mem.id }}", "mem_nm": "{{ mem.name }}"}'>
                        </td>
                        <td>{{ mem.name }}</td>
                        <td>{{ mem.group_nm }}</td>
                        <td>{{ mem.dept_nm }}</td>
                        <td>{{ mem.duty_resp_nm }}</td>
                        <td>{{ mem.posi_nm }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

        <div class="box-solid col-md-1">
            <a id="evalSfBtn" class="btn btn-app" onclick="addEvalSf()">
                <i class="fa fa-arrow-right"></i> 평가자
            </a>
            <a id="evalSBtn" class="btn btn-app" onclick="addBeEvalMem('evalSTbl')">
                <i class="fa fa-arrow-right"></i> 상사
            </a>
            <a id="evalMBtn" class="btn btn-app" onclick="addBeEvalMem('evalMTbl')">
                <i class="fa fa-arrow-right"></i> 동료
            </a>
            <a id="evalJBtn" class="btn btn-app" onclick="addBeEvalMem('evalJTbl')">
                <i class="fa fa-arrow-right"></i> 부하
            </a>

        </div>
    </div>
</div>


<script>

    // 평가자 추가 disable
    function EvalSfBtnStyle() {
        if ($('#evalSfTbl').find('td:first-child').length === 1) {
            $("#evalSfBtn").removeClass("bg-olive").addClass("disabled")
            $("#evalSBtn").removeClass("disabled").addClass("bg-olive")
            $("#evalMBtn").removeClass("disabled").addClass("bg-olive")
            $("#evalJBtn").removeClass("disabled").addClass("bg-olive")
        } else {
            $("#evalSfBtn").removeClass("disabled").addClass("bg-olive")
            $("#evalSBtn").removeClass("bg-olive").addClass("disabled")
            $("#evalMBtn").removeClass("bg-olive").addClass("disabled")
            $("#evalJBtn").removeClass("bg-olive").addClass("disabled")
        }
    }

    // 체크 박스 전체 checked 해제
    function removeChecked() {
        let memIdChkBox = $('input[name=memIdChkBox]:checkbox')
        memIdChkBox.prop("checked", false)
        memIdChkBox.attr("checked", false)
    }

    // 체크 박스 행 선택
    function chkBoxClick(value) {
        let checkBox = $(`#${value}`).find('td:first-child :checkbox')
        console.log(checkBox.attr("checked"))
        if (checkBox.attr("checked") === "checked") {
            checkBox.prop("checked", false)
            checkBox.removeAttr("checked")

        } else {
            checkBox.prop("checked", true)
            checkBox.attr("checked", true)
        }
    }

    function addEvalSf() {
        let memIdChkBox = $('input:checkbox[name=memIdChkBox]:checked').toArray()
        console.log(memIdChkBox)
        if (memIdChkBox.length === 1) {
            let memIdDic = JSON.parse($(memIdChkBox[0]).val())
            let newRow = `<tr id='rel_${memIdDic['mem_id']}'>`
                            + "<td hidden>" + memIdDic["mem_id"] + "</td>"
                            + "<td>" + memIdDic["mem_nm"] + "</td>"
                            + `<td><input onclick=delEvalMem(${memIdDic['mem_id']}) type='button' class='btn btn-block btn-danger btn-xs' value='삭제'></td>`
                        + "<tr>"

            $("#evalSfTbl").append(newRow)
            $(memIdChkBox[0].closest('tr')).hide()

        } else {
            swal({
                text: "평가자는 한명만 선택할 수 있습니다."
            })
        }

        console.log("평가자 추가 버튼")
        removeChecked()
        EvalSfBtnStyle()
    }

    function addBeEvalMem(tbl) {
        console.log(tbl)
        let memIdChkBox = $('input:checkbox[name=memIdChkBox]:checked').toArray()
        console.log(memIdChkBox)
        for (let i = 0; i < memIdChkBox.length; i++) {
            let memIdDic = JSON.parse($(memIdChkBox[i]).val())
            console.log(memIdDic)
            let newRow = `<tr id='rel_${memIdDic['mem_id']}'>`
                            + "<td hidden>" + memIdDic["mem_id"] + "</td>"
                            + "<td>" + memIdDic["mem_nm"] + "</td>"
                            + `<td><input onclick=delEvalMem(${memIdDic['mem_id']}) type='button' class='btn btn-block btn-danger btn-xs' value='삭제'></td>`
                        + "<tr>"
            $(`#${tbl}`).append(newRow)
            $(memIdChkBox[i].closest('tr')).hide()
        }
        removeChecked()
    }

    $(function () {
        // 로딩시 평가자 추가 버튼 스타일
        EvalSfBtnStyle()

        // 로딩시 데이터 테이블 기초 설정
        $("#memList").DataTable({
            "language": {
                "decimal": "",
                    "emptyTable": "표에서 사용할 수있는 데이터가 없습니다.",
                    "info": "총 _TOTAL_명   _START_에서 _END_까지 표시",
                    "infoEmpty": "0 개 항목 중 0 ~ 0 개 표시",
                    "infoFiltered": "(_MAX_ 총 항목에서 필터링 됨)",
                    "infoPostFix": "",
                    "thousands": ",",
                    "lengthMenu": "_MENU_",
                    "loadingRecords": "로드 중 ...",
                    "processing": "처리 중 ...",
                    "search": "사원명 검색: ",
                    "zeroRecords": "일치하는 레코드가 없습니다.",
                    "paginate": {
                        "first": "처음",
                        "last": "마지막",
                        "next": "다음",
                        "previous": "이전"
                    },
                    "aria": {
                        "sortAscending": ": 오름차순으로 정렬",
                        "sortDescending": ": 내림차순으로 정렬"
                    }
            },
            "paging": true,
            "lengthChange": true,
            "searching": true,
            "ordering": true,
            "info": false,
            "autoWidth": true
        });
    })
</script>